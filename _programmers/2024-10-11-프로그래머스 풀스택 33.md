---
layout: post
title:  "í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ í’€ìŠ¤íƒ 33"
excerpt: "í’€ìŠ¤íƒ33"
category: programmers
tags: [programmers]
date: '2024-10-11 15:00:00 +09:00'
last_modified_at: '2024-10-11'
---

# í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ í’€ìŠ¤íƒ 33
í”„ë¡œì íŠ¸: Node.js ê¸°ë°˜ì˜ REST API êµ¬í˜„(10)

## ğŸŒŠ ì£¼ë¬¸ API ì‹œì‘
<span style="color:lightseagreen">ğŸ’« **ì£¼ë¬¸ API ì‹œì‘**</span><br>

![alt text](img01/image-377.png)<br>
- POSTMANì—ì„œ ì‹¤í–‰ ì˜ ë¨<br><br/>

## ğŸŒŠ ì£¼ë¬¸ DB ERD ì„¤ê³„

<span style="color:lightseagreen">ğŸ’« **ì£¼ë¬¸ DB ERD ì„¤ê³„**</span><br>

![alt text](img01/image-378.png)<br><br/>

## ğŸŒŠ ì£¼ë¬¸ DB ìƒì„±

<span style="color:lightseagreen">ğŸ’« **ì£¼ë¬¸ DB ìƒì„±**</span><br>

![alt text](img01/image-379.png)<br>
- Workbenchì—ì„œ orders, orderedBook, delivery í…Œì´ë¸” ìƒì„± ì™„ë£Œ<br><br/>

## ğŸŒŠ FK ì œì•½ì¡°ê±´ ìƒì„±, ì „ì²´ ì œì•½ì¡°ê±´ ì»¨ë²¤ì…˜

<span style="color:lightseagreen">ğŸ’« **FK ì œì•½ì¡°ê±´ ìƒì„±, ì „ì²´ ì œì•½ì¡°ê±´ ì»¨ë²¤ì…˜**</span><br>

**[FK ì œì•½ì¡°ê±´ ì´ë¦„ ì§“ê¸°] : "ì»¨ë²¤ì…˜"**<br>
fk_ê¸°ì¤€ í…Œì´ë¸”ëª…_ì°¸ì¡°í…Œì´ë¸”ëª…_ì°¸ì¡°í‚¤<br>
**cartItems.user_id > users.id** : fk_cartItems_users_id<br>
**likes_user_id > users.id** : fk_likes_users_id<br>

ê°ê°ì˜ í…Œì´ë¸”ì— ì € í˜•ì‹ìœ¼ë¡œ FK ì œì•½ì¡°ê±´ ì´ë¦„ ìƒì„±í•˜ê¸°!<br><br/>

## ğŸŒŠ ì£¼ë¬¸í•˜ê¸° SQL ìƒê°í•´ë³´ê¸°

<span style="color:lightseagreen">ğŸ’« **ì£¼ë¬¸í•˜ê¸° SQL ìƒê°í•´ë³´ê¸°**</span><br>

![alt text](img01/image-380.png)<br>

```sql
// ë°°ì†¡ ì •ë³´ ì…ë ¥
INSERT INTO delivery (address, receiver, contact) VALUES ("ì„œìš¸ì‹œ ì¤‘êµ¬", "ê¹€ë‚œì˜", "010-1234-5678");
```

```sql
// ì£¼ë¬¸ ì •ë³´ ì…ë ¥
INSERT INTO orders (book_title, total_quantity, total_price, user_id, delivery_id) 
VALUES ("ì–´ë¦°ì™•ìë“¤", 3, 60000, 1, 1);
```

```sql
// ì£¼ë¬¸ ìƒì„¸ ëª©ë¡ ì…ë ¥
INSERT INTO orderedBook (order_id, book_id, quantity)
VALUES (1, 1, 1);
INSERT INTO orderedBook (order_id, book_id, quantity)
VALUES (1, 3, 2);
```
API ì„¤ê³„ëŒ€ë¡œ delivery, orders, orderedBookìˆœì„œëŒ€ë¡œ insert ì³ì£¼ê¸°!<br><br/>

## ğŸŒŠ delivery í…Œì´ë¸” insert, insertId ê°€ì ¸ë‹¤ì“°ê¸°

<span style="color:lightseagreen">ğŸ’« **delivery í…Œì´ë¸” insert, insertId ê°€ì ¸ë‹¤ì“°ê¸°**</span><br>

**ë°©ê¸ˆ insertí•œ ë°ì´í„° PK ê°€ì ¸ì˜¤ëŠ” ë²•**<br>

```sql
SELECT last_insert_id();
```
- **LAST_INSERT_ID()** : ì‹œê°„ì°¨ ê³µê²© ğŸ‘‰ í•˜ë‚˜ì˜ ì„¸ì…˜ì—ë§Œ ìœ ì§€ê°€ ë˜ë¯€ë¡œ ì´ì „ ê°’ì„ ë“¤ê³ ì˜¤ëŠ” ì˜¤ë¥˜ê°€ ì¢…ì¢… ë°œìƒ!<br><br>

```sql
SELECT max(id) FROM Bookshop.orderedBook;
```
- **max()** : ìš°ë¦¬ê°€ í•„ìš”í•œ ê±´ ì–¸ì œë‚˜ ìµœì‹  ê°’ì´ë¯€ë¡œ max()ê°’ì„ ê°€ì ¸ì˜¤ë©´ ë¨!<br>


```sql
const delivery_id = SELECT max(id) FROM delivery;
```
ë”°ë¼ì„œ ì´ëŸ° í˜•íƒœë¡œ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©ë„ ê°€ëŠ¥í•¨<br>


<br><br/>

## ğŸŒŠ delivery í…Œì´ë¸” insert, insertId ê°€ì ¸ë‹¤ì“°ê¸°

<span style="color:lightseagreen">ğŸ’« **delivery í…Œì´ë¸” insert, insertId ê°€ì ¸ë‹¤ì“°ê¸°**</span><br>

\<POSTMAN ê²°ê³¼><br>
![alt text](img01/image-381.png)<br>
- ì—¬ê¸°ì„œ insertIdëŠ” PKê°’ì´ë¯€ë¡œ ê°€ì ¸ë‹¤ê°€ ì“°ë©´ ë¨!<br><br>

![alt text](img01/image-382.png)<br>
- delivery_id = results.insertId;ë¡œ ê°€ì ¸ë‹¤ ì“°ëŠ” ëª¨ìŠµ<br><br/>

## ğŸŒŠ orders insert

<span style="color:lightseagreen">ğŸ’« **orders insert**</span><br>

![alt text](img01/image-383.png)<br>
- ê²°ì œ API ìˆ˜ì •. firtBookTitle ì¶”ê°€<br><br>

![alt text](img01/image-384.png)<br>

\<POSTMAN ê²°ê³¼><br>
![alt text](img01/image-385.png)<br>

\<Workbench ê²°ê³¼><br>
![alt text](img01/image-386.png)<br><br/>

## ğŸŒŠ orderedBook insert

<span style="color:lightseagreen">ğŸ’« **orderedBook insert**</span><br>

```javascript
    sql = `INSERT INTO orderedBook (order_id, book_id, quantity) VALUES ?`;
    // items.. ë°°ì—´ : ìš”ì†Œë“¤ì„ í•˜ë‚˜ì”© êº¼ë‚´ì„œ(foreachë¬¸ ëŒë ¤ì„œ) >
    values = [];
    items.forEach((item) => {
        values.push([order_id, item.book_id, item.quantity]);
        console.log(values);
    })
    conn.query(sql, [values],
        (err, results) => {
            if (err) {
                console.error(err);
                return res.status(StatusCodes.INTERNAL_SERVER_ERROR).end();
            }

            return res.status(StatusCodes.OK).json(results);
    })        
};
```
- ì´ì¤‘ ë°°ì—´ì„ ì´ìš©í•´ì„œ ê°’ì„ ë„£ì„ ë•Œ `conn.query(sql, [values]`ë¡œ valuesë¥¼ ê°ì‹¸ì£¼ëŠ” ê²ƒ ìŠì§€ ë§ê¸°!!!<br>
- forEachë¬¸ì„ í†µí•´ 2ì°¨ì› ë°°ì—´(ì´ì¤‘ ë°°ì—´)ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŒ!<br>
- ì´ëŸ° ê±¸ ë³´ê³  ë²Œí¬(ë¬¶ìŒ)ë¡œ insertë¥¼ í•œë‹¤ê³  í•¨!(insertë¥¼ ë‘ ë²ˆ, ì„¸ ë²ˆ í•œêº¼ë²ˆì— ë„£ê¸°)<br>
- ê²°ë¡  : ì´ì¤‘ë°°ì—´ì„ í†µí•´ í•œë²ˆì— ëŒ€ê·œëª¨ì˜ ë°ì´í„°ë¥¼ ë„£ì„ ìˆ˜ ìˆë‹¤!<br><br/>

## ğŸŒŠ ëŠë‚€ ì (YWT)

**Y ì¼ì„ í†µí•´ ëª…í™•íˆ ì•Œê²Œ ë˜ì—ˆê±°ë‚˜ ì´í•´í•œ ë¶€ë¶„(í•œ ì¼)ì— ëŒ€í•´ ì •ë¦¬ :**<br>
ë°©ê¸ˆ insertí•œ ë°ì´í„° PK ê°€ì ¸ì˜¤ëŠ” ë²•, forEachë¬¸ì„ í†µí•´ 2ì°¨ì› ë°°ì—´(ì´ì¤‘ ë°°ì—´)ë¡œ ê°’ì„ ë²Œí¬ë¡œ ë³´ë‚´ëŠ” ê±¸ ë°°ì›€!<br>

**W ë°°ìš´ ì ê³¼ ì‹œì‚¬ì  :**<br>
forEachë¬¸ì„ í†µí•´ 2ì°¨ì› ë°°ì—´(ì´ì¤‘ ë°°ì—´)ë¡œ ê°’ì„ ë²Œí¬ë¡œ ë³´ë‚´ëŠ” ê±¸ ë°°ì›€!<br>
ë°©ê¸ˆ insertí•œ ë°ì´í„° PK ê°€ì ¸ì˜¤ëŠ” ë²• : max() ì‚¬ìš©!<br>

**T ì‘ìš©í•˜ì—¬ ë°°ìš´ ê²ƒì„ ì–´ë””ì— ì–´ë–»ê²Œ ì ìš©í• ì§€:**<br>
ì£¼ë¬¸ API ì‘ì„±í•  ë•Œ ì‘ìš©ê°€ëŠ¥!<br>